{%- liquid
  assign componentLimit = component.limit | default: 200
  assign root = site.root_page
  assign itemReadMoreButtonText = page.content[component.region_names.readMoreButtonText] | default: component.defaultItemButtonText
  assign componentLabels = component.customLabel | default: component.itemLabels
  assign items = root.descendants | filter_pages: by: component.loopBy, sort: component.loopOrder, tags: componentLabels, tags_match: component.loopLabelsMatch, hidden: component.showHidden, random: component.random, limit: componentLimit

  assign itemCount = 0

  for items in items.all
    assign itemCount = itemCount | plus: 1
  endfor

  if items > component.limit
    assign itemCount = component.limit | times: 1
  endif
-%}

{%- for item in items -%}
  {%- capture itemsByName -%}
    {{ item }},
  {%- endcapture %}
{%- endfor -%}

{% assign itemsByName = itemsByName | split: ',' %}
{% assign itemsByName = itemsByName | sort %}

{% capture component_content %}
  <div class="container wvu-z-index-content">
    {%- if edit_mode or page.content[component.region_names.header] != blank %}
      {% comment %}<!-- This is just a label for the editable region that follows in order to make it clear to content editors what the region is for (in case they delete content and forget). -->{% endcomment %}
      {% if edit_mode %}<span class="d-inline-block badge bg-primary mb-1">Header</span>{% endif %}
      {% comment %}<!-- For the h2, apply an ID that will tell screanreaders to use this element as the label for the section. Also apply classes to the header. If supplied by user, use those. If not use default. -->{% endcomment %}
      {% editable_region_block name: component.region_names.header scope: component.scope %}
        <h2 id="{{ component.name }}-label" class="display-3 wvu-shout text-wvu-blue wvu-slash wvu-slash--skinny visually-hidden">Directory Headline</h2>
      {% endeditable_region_block %}
    {%- endif %}

    {% if edit_mode and itemCount == 0 %}
      {% render "includes/wvu-collection-warnings/wvu-collection-labels-warning--v1" component: component %}
    {% else %}
      {% render "includes/wvu-collection-warnings/wvu-collection-labels-label-tooltip--v1" component: component %}
    {% endif %}

    <div class="table-responsive-md">
      <table class="table">
        <caption class="caption-top visually-hidden">Directory</caption>
        <tbody class="border-top-0">
          {% for item in itemsByName %}
            <tr class="border-bottom border-light">
              <th scope="row" class="py-2 w-25">
                <div class="row">
                  <div class="col-4">
                    {% if item.data.thumbnail_url_sq != blank %}
                      {% assign itemThumbnailSrc = item.data.thumbnail_url_sq | build_image_url: size: '200x200', format: 'webp' %}
                      <img class="rounded-circle shadow d-inline-block" src="{{ itemThumbnailSrc }}" alt="{{ item.content['wvu-profile-1__name'] | default: item.name }} headshot" />
                    {% endif %}
                  </div>
                  <div class="col-8 align-self-center">
                    {% if item.content['wvu-profile-1__name'] != blank %}
                      <strong class="d-block">{{ item.content['wvu-profile-1__name'] | default: item.name }}</strong>
                    {% else %}
                      <strong class="d-block">{{ item.alternate_name | default: item.name }}</strong>
                    {% endif %}
                    {%- if item.content['wvu-profile-1__title'] != blank %}
                      <small class="helvetica-neue-light d-block">{{ item.content['wvu-profile-1__title'] }}</small>
                    {%- endif %}
                  </div>
                </div>
              </th>
              <td class="align-middle">
                {%- if item.content['wvu-profile-1__phone'] != blank %}
                  <span aria-hidden="true" class="fa-solid fa-phone"></span> <a href="tel:{{ item.content['wvu-profile-1__phone'] }}">{{ item.content['wvu-profile-1__phone'] }}</a>
                {%- endif %}
              </td>
              <td class="align-middle">
                {%- if item.content['wvu-profile-1__email'] != blank %}
                  <span aria-hidden="true" class="fa-solid fa-envelope"></span> <a href="mailto:{{ page.content['wvu-profile-1__email'] }}"> {{ item.content['wvu-profile-1__email'] }}</a>
                {%- endif %}
              </td>
              <td class="align-middle">
                {%- if item.content['wvu-profile-1__office'] != blank %}
                  <span aria-hidden="true" class="fa-solid fa-building"></span> {%- if item.content['wvu-profile-1__office-url'] != blank %} <a href="{{ item.content['wvu-profile-1__office-url'] }}">{{ item.content['wvu-profile-1__office'] }}</a>{% else %} {{ item.content['wvu-profile-1__office'] }}{%- endif %}
                {%- endif %}
              </td>
              {% if itemReadMoreButtonText != 'none' %}
                {% if item.data.link_text != blank %}
                  {% assign link_text = item.data.link_text %}
                {% else %}
                  {% capture link_text %}{{ itemReadMoreButtonText }}<span class="visually-hidden">: {{ item.name }}</span>{% endcapture %}
                {% endif %}
                <td class="align-middle">
                  <span aria-hidden="true" class="fa-solid fa-user-circle"></span> <a href="{{ link_href }}">{{ link_text }}</a>
                </td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% comment %}
    {% assign pagination = items | blog_pagination %}
    {% if pagination.total_pages > 1 %}
      <nav class="btn-group" aria-label="Pagination">
        <a href="{{ pagination.next_page_url }}" class="btn btn-secondary page-link{% if pagination.is_last_page %} disabled{% endif %}">Older Articles</a>
        <a href="{{ pagination.prev_page_url }}" class="btn btn-secondary page-link{% if pagination.is_first_page %} disabled{% endif %}">Newer Articles</a>
      </nav>
    {% endif %}
    {% endcomment %}

  </div>
{% endcapture %}

{% render "utilities/wvu-component-tag/wvu-component-tag--v1" component: component, content: component_content %}
{% render "includes/wvu-component-footer/wvu-component-footer--v1" component: component %}
